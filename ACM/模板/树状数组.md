### 区间修改+区间查询

```C++
#include<bits/stdc++.h>
#define lowbit(x) (x&-x)
#define int long long
#define range_ask(l,r) query(r)-query(l-1)
#define range_add(l,r,x) add(l,x),add(r+1,-x)
using namespace std;
const int maxn=1e6+7;
int n,q,op,l,r,tmp,sum1[maxn],sum2[maxn],a[maxn];

void add(int x,int y){
	for(int i=x;i<=n;i+=lowbit(i)){
		sum1[i]+=y;
		sum2[i]+=x*y;
	}
}

int query(int x){
	int res=0;
	for(int i=x;i;i-=lowbit(i)){
		res+=(x+1)*sum1[i]-sum2[i];
	}
	return res;
}

signed main(){
	ios::sync_with_stdio(0);cin.tie(0);cout.tie(0);
	cin>>n>>q; 
	for(int i=1;i<=n;i++){
		cin>>a[i];
		tmp=a[i]-a[i-1];
		add(i,tmp);
	}
	for(int j=1;j<=q;j++){
		cin>>op;
		if(op==1){
			cin>>l>>r>>tmp;
			range_add(l,r,tmp);
		}
		if(op==2){
			cin>>l>>r;
			cout<<range_ask(l,r)<<endl;
		}
	}
	return 0;
}
```



### 二维单点修改+区间查询

```C++
#include<bits/stdc++.h>
#define lowbit(x) (x&-x)
#define int long long

using namespace std;
const int maxn=5000;
int n,m,op,a,b,c,d,tmp,tr[maxn][maxn];

void add(int x,int y,int z){
	for(int i=x;i<=n;i+=lowbit(i)){
		for(int j=y;j<=m;j+=lowbit(j)){
			tr[i][j]+=z;
		}
	}
}

int ask(int x,int y){
	int res=0;
	for(int i=x;i;i-=lowbit(i)){
		for(int j=y;j;j-=lowbit(j)){
			res+=tr[i][j];
		}
	}
	return res;
}

int range_ask(int xa,int ya,int xb,int yb){
	return ask(xb,yb)-ask(xb,ya-1)-ask(xa-1,yb)+ask(xa-1,ya-1);
}

signed main(){
	scanf("%lld%lld",&n,&m);
	while(scanf("%lld",&op)!=EOF){
		if(op==1){
			scanf("%lld%lld%lld",&a,&b,&c);
			add(a,b,c);
		}
		if(op==2){
			scanf("%lld%lld%lld%lld",&a,&b,&c,&d);
			printf("%lld\n",range_ask(a,b,c,d));
		}
	}
	return 0;
}
```



### 二维区间修改+单点查询

```C++
#include<bits/stdc++.h>
#define lowbit(x) (x&-x)
#define int long long

using namespace std;
const int maxn=5000;
int n,m,op,a,b,c,d,tmp,tr[maxn][maxn];

void add(int x,int y,int z){
	for(int i=x;i<=n;i+=lowbit(i)){
		for(int j=y;j<=m;j+=lowbit(j)){
			tr[i][j]+=z;
		}
	}
}

int ask(int x,int y){
	int res=0;
	for(int i=x;i;i-=lowbit(i)){
		for(int j=y;j;j-=lowbit(j)){
			res+=tr[i][j];
		}
	}
	return res;
}

void range_add(int xa,int ya,int xb,int yb,int k){
	add(xa,ya,k);
	add(xa,yb+1,-k);
	add(xb+1,ya,-k);
	add(xb+1,yb+1,k);
}

signed main(){
	scanf("%lld%lld",&n,&m);
	while(scanf("%lld",&op)!=EOF){
		if(op==1){
			scanf("%lld%lld%lld%lld%lld",&a,&b,&c,&d,&tmp);
			range_add(a,b,c,d,tmp);
		}
		if(op==2){
			scanf("%lld%lld",&a,&b);
			printf("%lld\n",ask(a,b));
		}
	}
	return 0;
}
```

